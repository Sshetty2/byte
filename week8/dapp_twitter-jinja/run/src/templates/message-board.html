<!DOCTYPE html>
<html lang="en">
<head>
  <title>Web Trader</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
 <style>

body{
	font: 12px Arial,Tahoma,Helvetica,FreeSans,sans-serif;
	text-transform: inherit;
	color: #333;
	background: #e7edee;
	width: 100%;
}
.wrap{
	width: 720px;
	margin: 15px auto;
	padding: 15px 10px;
	background: white;
	border: 2px solid #DBDBDB;
	-webkit-border-radius: 5px;
	-moz-border-radius: 5px;
	border-radius: 5px;
}
.title, .userName {
  font-weight:700;
}

.post {
  border-bottom: 1px solid black;
  padding-bottom: 5px;
}

.post .title{
  font-style:italic;
}
.post .body{
  margin-top:5px;
}

  
  </style> 




</head>
<body>

<div class="wrap"> 
  <div>
    <h1 class="title"> Filters </h1>
    
    <div class="byUser">
      <span class="title">All post by User : </span>
      <select id="selUser">
        <option value=0>All</option>
      </select>
      <button type="button" onclick="searchUser()">Search </button>
    </div>
  </div>
  
  </div>
  
  <div class="wrap">
    <div><h1 class="title">Posts</h1></div>
    <p class="reply">
    </p>
  </div>


<script>

  var getData = [];
  var usersList = [];

function status(response) {
  //Check Promise
  if (response.status >= 200 && response.status < 300) {
    return Promise.resolve(response)
  } else {
    return Promise.reject(new Error(response.statusText))
  }
}

function json(response) {
  //Return JSON format
  return response.json()
}

function getUsers(){
  
  fetch('https://jsonplaceholder.typicode.com/users')
  .then(status)
  .then(json)
  .then(function(dataList) {
    usersList = dataList;    
    dataList.forEach(function(data){
      $('#selUser').append($('<option>', { 
        value: data.id,
        text : data.name 
    }));
      
    });
    getPosts("");
    
    
  })
  .catch(function(error) {
    console.log('Fetch User Error :-S', error);
  });
  
}

function getPosts(option){
  
  fetch('https://jsonplaceholder.typicode.com/posts' + option)
  .then(status)
  .then(json)
  .then(function(dataList) {
    getData = dataList;
    var divReply = $(".reply")
    divReply.empty();
    
    dataList.forEach(function(data){
      var post = $('<p class="post"/>');
      
      var divID = $('<div class="userName"/>').append($('<span>').append('By: ', usersList[data.userId - 1].name));    
      var divTitle = $('<div class="title"/>').append(data.title);
      var divBody = $('<div class="body"/>').append(data.body)
      
      divReply.append(post.append(divID,divTitle,divBody));
      
    });
    
  })
  .catch(function(error) {
    console.log('Fetch Post Error :-S', error);
  });
}



$(document).ready(function() {
  //Get Post On Document Ready
  getUsers();
})

function searchUser(){
  var userSelected = $('#selUser').val();
  
  if (userSelected != 0){
    getPosts("?userId=" + userSelected);
  }
  else{
    getPosts("");
  }
}

</script>


</body>
</html>


